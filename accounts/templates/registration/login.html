{% extends 'base.html' %}
{% load staticfiles %}

{% block head %}
    <link rel="stylesheet" href="{% static 'accounts/css/login.css' %}">
{% endblock %}

{% block title %}
    Login|Signup
{% endblock %}

{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-sm-3"></div>
            <div class="col-sm-6">
                {% if error %}
                    <div class="alert alert-danger">
                        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                        {{ error }}
                    </div>
                {% endif %}
                <div class="panel panel-default cart">
                    <div class="panel-heading">
                        <ul class="nav nav-tabs">
                            <li {% if active == 'login' %}class="active"{% endif %}><a data-toggle="tab" href="#login">login</a>
                            </li>
                            <li {% if active == 'register' %}class="active"{% endif %}><a data-toggle="tab"
                                                                                          href="#register">signup</a>
                            </li>
                        </ul>
                    </div>
                    <div class="panel-body">
                        <div class="tab-content">
                            <div id="login" class="tab-pane fade {% if active == 'login' %}in active{% endif %}">
                                <form role='form' action="{% url 'accounts:login' %}" method="post">
                                    {% csrf_token %}
                                    {{ login_form }}
                                    <hr>
                                    <button type="submit" class='btn btn-default btn-block'>login</button>
                                </form>
                            </div>
                            <div id="register" class="tab-pane fade {% if active == 'register' %}in active{% endif %}">
                                <form role='form' action="{% url 'accounts:register' %}" method="post">
                                    {% csrf_token %}
                                    {{ register_form }}
                                    <hr>
                                    <button type="submit" class='btn btn-default btn-block'>Register</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="panel-footer">
                        <a href="#">forget password</a>
                    </div>
                </div>
            </div>
            <div class="col-sm-3"></div>
        </div>
    </div>


{% endblock %}

{% block domready %}
    $('#register #id_username').change(function () {
        $.get(
            '{% url "accounts:validate_username" %}' + '?username=' + $(this).val(),
            function (data) {
                $("#register #id_username").css('color', 'black');
                if (data.is_taken) {
                    var element = "<div class='alert alert-danger'>"
                        + '<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>'
                        + data.error_message + "</div>";
                    $("#register #id_username").before(element);
                } else {
                    $("#register #id_username").css('color', 'green');
                }
            }
        )
    })
{% endblock %}
